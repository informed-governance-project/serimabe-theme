{% extends 'security_objectives/so_dashboard_base.html' %}
{% load django_bootstrap5 %}
{% load i18n %}

{% block content_filter %}
    {% bootstrap_field filter.form.submitter_company label_class="fw-bold" wrapper_class="mb-3" %}                    
{% endblock %}

{% block progress_bar %}
{% with progress_value=standard.reviewed_percentage|default:0 %}
<div class="hstack gap-2">
    <span class="text-start w-15">{{ progress_value|floatformat:'0' }}%</span>
    {% if progress_value == 100 and standard.status in ",PASS,FAIL,DELIV," %}
    <button id="so_submit_button" type="button" class="rounded-pill btn btn-sm btn-passed w-75 review_comment_so_declaration"
        data-standard-answer-id="{{ standard.id }}"
        data-bs-toggle="modal" 
        data-bs-target="#review_comment_so_declaration">
        {% translate "Send" %}
        <i class="custom-icon-submit h4"></i>
    </button>
    {% else %}
    <div class="progress w-75">
        <div class="progress-bar {% if progress_value == 100 %}bg-passed{% elif progress_value != 100 and progress_value > 40 %}bg-warning{% else %}bg-failed{% endif %}"
            role="progressbar" style="width: {{ progress_value|floatformat:'0' }}%"
            aria-valuenow="{{ progress_value|floatformat:'0' }}" aria-valuemin="0" aria-valuemax="100">
        </div>
    </div>
    {% endif %}
</div>
{% endwith %}
{% endblock %}

{% block content_table_actions %}
<a class="btn border-0 p-0 text-dark {% if standard.status == 'UNDE' %}disabled{% endif %}" 
    href="{% url 'so_declaration' %}?id={{ standard.id }}"
    {% if standard.status == 'UNDE' %}aria-disabled="true" disabled{% endif %}
    onclick="load_spinner()">
    <i class="custom-icon-edit h4"
        data-bs-placement="top" data-bs-toggle="tooltip" title="{% translate 'Review' %}">
    </i>
</a>
<button class="btn border-0 p-0 download-link" data-standard-answer-id="{{ standard.id }}">
    <i class="custom-icon-pdf h4"
        data-bs-placement="top" data-bs-toggle="tooltip" title="{% translate 'Download' %}">
    </i>
</button>
<button class="btn border-0 p-0 so_access_log" data-standard-answer-id="{{ standard.id }}">
    <i class="custom-icon-log h4"
        data-bs-placement="top" data-bs-toggle="tooltip" title="{% translate 'Access Log' %}">
    </i>
</button>
<button class="btn border-0 p-0 delete_so_declaration"
    data-standard-answer-id="{{ standard.id }}"
    data-delete-url="{% url 'delete_so_declaration' 0 %}"
    data-bs-toggle="modal"
    data-bs-target="#delete_so_declaration">
    <i class="custom-icon-trash h4"        
        data-bs-placement="top" data-bs-toggle="tooltip" title="{% translate 'Delete' %}">
    </i>
</button>
{% endblock %}

{% block content_table_legend %}
<li class="legend-item">
    <div class="icon-container border border-passed border-2 rounded-circle d-flex justify-content-center align-items-center">
        <i class="custom-icon-passed m-0 h5" aria-hidden="true"></i>
    </div>
    {% translate "Passed" %}
</li>
<li class="legend-item">
    <div class="icon-container bg-passed rounded-circle d-flex justify-content-center align-items-center">
        <i class="custom-icon-passed-sent m-0 h5" aria-hidden="true"></i>
    </div>
    {% translate "Passed and sent" %}
</li>
<li class="legend-item">
    <div class="icon-container bg-under-review rounded-circle d-flex justify-content-center align-items-center">
        <i class="custom-icon-under-review-white m-0 h5" aria-hidden="true"></i>
    </div>
    {% translate "Under review" %}
</li>
<li class="legend-item">
    <div class="icon-container border border-failed border-2 rounded-circle d-flex justify-content-center align-items-center">
        <i class="custom-icon-failed m-0 h5" aria-hidden="true"></i>
    </div>
    {% translate "Revision required" %}
</li>
<li class="legend-item">
    <div class="icon-container bg-failed rounded-circle d-flex justify-content-center align-items-center">
        <i class="custom-icon-failed-sent m-0 h5" aria-hidden="true"></i>
    </div>
    {% translate "Revision required and sent" %}
</li>
{% endblock %}

{% block content_modals %}
{{ block.super }}
<div class="modal fade" id="delete_so_declaration" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="delete_so_declaration_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        {% include "modals/delete_so_declaration.html" %}
    </div>
</div>
{% endblock %}