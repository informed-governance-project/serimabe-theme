{% extends 'home/base.html' %}
{% load i18n %}
{% load django_bootstrap5 %}
{% load reporting_filters %}
{% load static %}

{% block bootstrap5_extra_script %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'npm_components/datatables.net-bs5/css/dataTables.bootstrap5.min.css' %}" />
<script type="text/javascript" src="{% static 'npm_components/datatables.net/js/dataTables.min.js' %}"></script>
<script type="text/javascript"src="{% static 'npm_components/datatables.net-bs5/js/dataTables.bootstrap5.min.js' %}"></script>
<script src='{% static "js/add_reporting_recommendations.js" %}'></script>
{% endblock %}

{% block bootstrap5_title %}
{% translate "Add recommendations" %}
{% endblock %}

{% block content %}
<h3>{% translate "Add recommendations" %}</h3>
<h5 class="text-muted">{{ year }} {{ company }} [{{ sector }}]</h5>
<div class="d-flex">
    <div class="me-auto">
        <button id="addSelectedButton" class="btn btn-primary btn-sm">
            {% translate "Add selected recommendation(s)" %}
        </button>
        <a class="btn btn-danger btn-sm" href="{% url 'report_recommendations' company.id sector.id year %}">
            {% translate "Cancel" %}
            </a>
    </div>
    <button class="btn btn-primary btn-sm ms-auto" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapseFilters" aria-expanded="false" aria-controls="collapseFilters">
        {% translate "Filter" %}
        {% if is_filtered %}
        <span>
            ({% translate "Applied" %})
        </span>
        {% endif %}
        <i class="bi bi-funnel-fill"></i>
    </button>
</div>
<div class="my-2">
    <div id="collapseFilters" class="collapse">
        <form method="GET">
            <div class="d-flex justify-content-end">
                <div class="col-3">
                    {% bootstrap_field filter.form.code %}
                </div>
                <div class="col-3">
                    {% bootstrap_field filter.form.description %}
                </div>
                <div class="col-3">
                    {% bootstrap_field filter.form.sectors wrapper_class="sector-filter" %}
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button class="btn btn-danger btn-sm" type="submit" name="reset" value="true">
                    {% translate "Reset" %}
                </button>
                <input class="btn btn-primary btn-sm ms-2" type="submit" value='{{_("Search")}}' />
            </div>
        </form>
    </div>
</div>

<form id="recommendationsTableForm" method="POST" action="">
    {% csrf_token %}
    {{ formset.management_form }}
    <table id="add-reporting-recommendations-table" class="table align-middle table-sm small">
        <thead>
            <tr>
                <th class="d-flex align-items-center justify-content-center">
                    <input id="select_all_recommendations" class="form-check-input large-checkbox" type="checkbox">
                </th>
                <th class="col-auto">{% translate "Name" %}</th>
                <th class="col-auto">{% translate "Description" %}</th>
                <th class="col-auto">{% translate "Sectors" %}</th>
               </tr>
        </thead>
        <tbody>
            {% for form in formset %}
            <tr>
                {% bootstrap_field form.id %}
                <td class="col-1 table-group-divider">
                    {% bootstrap_field form.selected show_label=False field_class="large-checkbox" wrapper_class="d-flex align-items-center justify-content-center" %}
                </td>
                <td class="col-auto table-group-divider">
                    {{ form.code.value }}
                </td>
                <td class="col-auto table-group-divider">
                    {{ form.description.value }}
                </td>
                <td class="col-auto table-group-divider">
                    {% for sector in form.sectors %}
                        {% if sector.data.selected %}
                            {{ sector }}                          
                        {% endif %}
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</form>
{% endblock %}